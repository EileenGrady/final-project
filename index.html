<!doctype html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>
  <meta name='description' content=''>
  <meta name='author' content=''>

  <title>Industrial Pollution</title>

  <!-- Bootstrap core CSS, used for dropdown menu -->
  <link href='vendor/bootstrap/css/bootstrap.min.css' rel='stylesheet'>
  <!-- Mapbox CSS -->
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css' rel='stylesheet' />
  <!-- Custom styles for this template -->
  <link href='css/style.css' rel='stylesheet' />
  <!-- Google font styles -->
  <link href='https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css2?family=PT+Sans&display=swap' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css2?family=Bitter&display=swap' rel='stylesheet'>
</head>

<body>
  <main>

    <!-- Scrollytelling Intro -->
    <section id='intro'>
      <div id='container'>
        <h1 class='intro'>Exploring Industrial Pollution in the US</h1>
        <p class='intro'>
          In 1969, the burning of the Cuyahoga River in Cleveland, Ohio became a national symbol for the public’s
          outcry against industrial pollution. The public had been expressing increasing concern throughout the 1950s
          and 1960s, and the US reached a turning point when the Environmental Protection Agency was established in
          1970. The EPA began to monitor and enforce the increasing number of environmental laws passed by Congress
          aimed at reducing industrial pollution. Today there are two main programs in place that monitor industrial
          pollution in the United States, the Superfund Program and the Toxics Release Inventory.
        </p>
      </div>
      <div id='scroll-icon'>
        <a href='#'><span></span>Scroll</a>
      </div>
    </section>

    <!-- Main Scrollytelling Section -->
    <section id='scrollytelling'>

      <!-- Map  -->
      <figure>
          <div class='progress-container'>
            <div class='progress-bar' id='myBar'></div>
          </div>
        <div id='map'></div>
      </figure>

      <!-- Prose for the project, additional info describing each scene. -->
      <article>

        <!-- Scene 1 -->
        <div class='step'>
            <h2>Chapter One:</h2>
            <h2>The Superfund Program</h2>
        </div>

        <!-- Scene 1a -->
        <div class='step'>
          <p>
            <strong>The Superfund Program is responsible for the investigation and clean-up of contaminated sites left over from decades of unregulated industrial manufacturing and other activities. </strong>
            The most highly contaminated sites which require longer-term remedial action qualify for the National Priority List (NPL).
          </p>
          <p>
            <strong>In order to qualify for the NPL a site must receive a Hazard Ranking System (HRS) score of 28.5. </strong>
            The sites seen here were extracted from the EPA's Superfund website, and meet the qualifications for the NPL.
          </p>
          <ul>
            <span style='background:#f89c74'></span><label>Currently on the NPL</label> <br>
            <span style='background:#f6cf71'></span><label>Deleted from the NPL</label> <br>
            <span style='background:#9eb9f3'></span><label>Proposed for the NPL</label> <br>
            <span style='background:#66c5cc'></span><label>Removed from the Proposed the NPL</label> <br>
            <span style='background:#87c55f'></span><label>Not on the NPL, but qualifies for Superfund Alternative Approach</label>
          </ul>
        </div>

        <!-- Scene 1b -->
        <div class='step'>
          <p>
            But the sites you see here are merely representative points, and <strong>toxins from many of these sites have spread far beyond their boundaries. </strong>
            Next we will visit two case studies to explore just how far some of these contaminants have dispersed. 
          </p>
        </div>

        <!-- Scene 2 -->
        <div class='step'>
          <h3>Case Study #1:</h3> 
          <h4>Southeast Missouri Lead District</h4>
        </div>

        <!-- Scene 2a -->    
        <div class='step'>
          <p>
            Missouri is home to the largest lead concentrations in the world, which have been mined for over a century. 
            <strong>The Big River Mine Tailings site in Park Hills, Missouri has an HRS score of 84.91, the highest hazard ranking score of any superfund site in the country. </strong>
            This site includes eight enormous piles of mining waste totaling approximately 110 square miles in size. 
            These piles, like the one seen in the photo below, are heavily contaminated with lead and other heavy metals.
          </p>
          <img src='images/park-hills-chat-pile.jpg'>
          <p class='credit'>Photo Credit: <a
              href='http://www.nbcnews.com/id/8132449/ns/us_news-environment/t/toxic-mound-beloved-ex-mining-town/#.XrttSmhKg2w'>James
              A. Finley / AP</a></p>
          <p class='credit'>Source: <a
            href='https://cumulis.epa.gov/supercpad/cursites/csitinfo.cfm?id=0701639' target='_blank'>EPA</a></p>
        </div>

        
        <!-- Scene 2b -->
        <div class='step'>
          <p>
            <strong>Over time, heavy metals and toxic chemicals from these waste piles have leached into the groundwater, eventually draining into the Big River. </strong>
          </p>
          <ul>
            <span style='background:#88CCEE'></span><label>Big River</label> <br>
            <span style='background:#44AA99'></span><label>Big River Watershed</label> <br>
          </ul>
          <p>
            This process escalated in 1977, when approximately 50,000 cubic yards of this toxic waste was washed directly into the river during heavy rains. 
            <strong>Any toxins entering the Big River have been carried downstream, contaminating sediment and floodplains.</strong>
          </p>
          <p class='credit'>Source: <a
              href='https://cumulis.epa.gov/supercpad/cursites/csitinfo.cfm?id=0701639'
              target='_blank'>EPA</a></p>
        </div>

        <!-- Scene 2c -->
        <div class='step'>
          <p>
            But this site is not the only site contributing to pollution in the Big River Watershed and surrounding area. 
            <strong>There are five more defunct lead mines within the Big River watershed, and another just south.
            All of these sites are on the National Priority List, and have an HRS score of at least 50. </strong>
          </p>
            <ul>
              <span style='background:#88CCEE'></span><label>Big River</label> <br>
              <span style='background:#44AA99'></span><label>Big River Watershed</label> <br>
              <span style='background:#f89c74'></span><label>Southeast Missouri Lead District Superfund Site</label> <br>
            </ul>
          <p>
            The piles of toxic mining waste at each of these sites are susceptible to wind and water erosion. 
            Remediation efforts in cases like these usually begin by covering the waste piles to prevent any further erosion and subsequent distribution of toxic material. 
            <strong>But by the time these sites were identified as Superfund sites and remediation could begin, the damage was already done. </strong>
          </p>
          <p class='credit'>Source: <a href='http://www.msnbc.com/msnbc/life-missouris-fading-old-lead-belt' target='_blank'>Life in
              Missouri’s Fading Old Lead Belt</a></p>
        </div>

        <!-- Scene 2d -->
        <div class='step'>
          <p>
            Carried by wind, rain, human activity, and transported by way of the Big River, <strong>toxic mine waste has been distributed throughout this entire area, affecting soil, groundwater, and surface water. </strong> 
            It was also not uncommon for homes and developments to be built overtop mine waste before the dangers of lead were documented. 
            <strong>The total area affected by these seven Superfund sites covers four entire counties in Missouri. </strong>
          </p>
          <ul>
            <span style='background:#88CCEE'></span><label>Big River</label> <br>
            <span style='background:#44AA99'></span><label>Big River Watershed</label> <br>
            <span style='background:#f89c74'></span><label>Southeast Missouri Lead District Superfund Site</label> <br>
            <span style='background:#A5AA99'></span><label>County Outlines</label> <br>
          </ul>
          <p class='credit'>Source: <a
            href='epa.gov/mo/big-river-and-floodplain-st-francois-jefferson-and-washington-counties-missouri-fact-sheet-july'
            target='_blank'>EPA</a></p>
        </div>

        <!-- Scene 2e -->
        <div class='step'>
          <p>
            <strong>Next we will travel east to Massachusetts to investigate the second case study.</strong>
          </p>          
        </div>

        <!-- Scene 3 -->
        <div class='step'>
          <h3>Case Study #2:</h3>
          <h4>GE-Pittsfield/Housatonic River Superfund Site</h4>          
        </div>

        <!-- Scene 3a -->
        <div class='step'>
          <p>
            The <strong>General Electric transformer plant</strong> sitting on the banks of the Housatonic River in Pittsfield, Massachusetts was once known as “one of the crown jewels of GE’s electrical infrastructure, high voltage testing, and defense contracting business.” 
            <strong>The defunct plant is now proposed for the Superfund National Priority List, with an HRS score of 70.71. </strong>
          </p>
          <p>
            <strong>The primary concern at this site is the prolonged use of polychlorinated biphenyls (PCBs)</strong> by the plant as a coolant in the manufacture of transformers. 
            <strong>PCBs do not break down in the environment and are now known to cause both cancer and serious non-cancer health effects in humans and animals. </strong>
          </p>
          <p class='credit'>Source: <a href='https://www.wbur.org/radioboston/2016/06/29/ge-and-pittsfield' target='_blank'>GE Left
              Behind A Complex Legacy In Pittsfield</a></p>
        </div>

        <!-- Scene 3b -->
        <div class='step'>
          <p>
            <strong>For decades until they were banned in 1979, PCBs leaked from piping throughout the GE plant into the ground, or were directly dumped into the Housatonic River and other areas around the campus. </strong>
            The enormous footprint left behind by the defunct 300-acre plant is now part of the clean-up area designated by
            this Superfund site.
          </p>
          <ul>
            <span style='background:#D3B484'></span><label>GE-Pittsfield/Housatonic River Site clean-up area</label> <br>
          </ul>
          <p>
            The cleanup areas include various complexes making up the GE campus, in addition to properties located in
            the Housatonic's floodplain, a school, areas where the river was re-routed
            in the 1940s, and a half-mile reach of contaminated riverbanks and sediments in the East Branch
            of the Housatonic River.
          </p>
          <p>
            <strong>But the PCBs that made their way into the Housatonic River did not strictly remain in this area.</strong>
          </p>
          <p class='credit'>Source: <a href='https://www.masslive.com/politics/2016/01/in_pittsfield_general_electric.html'
              target='_blank'>In Pittsfield, General Electric plant closures leave bitter memories</a> and <a
              href='https://www.epa.gov/ge-housatonic' target='_blank'>EPA</a></p>
        </div>

        <!-- Scene 3c -->
        <div class='step'>
          <p>
            Over time, storms and floods have disturbed PCB laden sediment from the river bottom and soil from
            contaminated river banks, redistributing it further down the river and into floodplains. 
            <strong>The “Rest of River” cleanup area included in this Superfund site covers nearly 125 miles from the confluence
            of the East and West Branches in Pittsfield to just before the Long Island Sound in Connecticut. </strong>
          </p>
          <ul>
            <span style='background:#88CCEE'></span><label>Housatonic River</label> <br>
            <span style='background:#44AA99'></span><label>Housatonic Watershed</label> <br>
          </ul>
          </p>
          <p>
            <strong>PCBs are persistent in the environment, resistant to degradation, and accumulate quickly in the body. </strong>
            Fish and wildlife throughout the Housatonic watershed have tested at very high concentrations of PCBs, and
            both Massachusetts and Connecticut have issued consumption advisories.
            Humans are also at risk for exposure by direct contact with contaminated soil or sediment, or consumption of
            agricultural products produced in the floodplain.
            <strong>Without any clean-up intervention, PCBs could remain present in the Housatonic River ecosystem for hundreds of years.</strong>
          </p>
          <p class='credit'>Source: <a href='https://www.epa.gov/ge-housatonic' target='_blank'>EPA</a></p>
        </div>

        <!-- Scene 4 -->
        <div class='step'>
          <p>
            We just visited some of the most hazardous Superfund sites in the county. 
            <strong>A site must receive a hazard ranking system (HRS) score of at least 28.5 to be placed on the National Priority List, and the sites we just explored had HRS scores between 50 and 84.91. </strong>
            Superfund sites are contaminated places left over from decades of unregulated industrial manufacturing and other activities. 
            <strong>Next we will explore the Toxics Release Inventory (TRI), which is responsible for tracking toxic chemicals that are currently being released into the environment. </strong>
          </p>
        </div>

        <!-- Scene 5 -->
        <div class='step'>
          <h2>Chapter Two: </h2>
          <h2>Toxics Release Inventory (TRI)</h2>
        </div>

        <!-- Scene 5a -->
        <div class='step'>
          <p>
            <strong>The EPA also monitors active facilities all over the country that are currently releasing toxic chemicals
            into our air, water, and land under the TRI program. </strong>
            The TRI was established under the Emergency Planning and Community Right-to-Know Act (EPCRA) of 1986 after
            public concern grew over <strong>the 1984 Bhopal, India disaster, in which an American-owned Union Carbide pesticide
            plant released a cloud of highly toxic methyl isocyanate into the air, killing thousands of people. </strong>
            Then in 1985, another, although smaller, toxic cloud was released from a Union Carbide plant on the Kanawha
            River in West Virginia.
          </p>
          <p>
            <strong>As of 2018 there are 21,603 facilities that report the release of a toxic chemical as part of the TRI
            program.</strong>
          </p>
          <ul>
            <span style='background:#cadb75'></span><label>Facilities reporting to TRI in 2018</label> <br>
          </ul>
        </div>

        <!-- Scene 6 -->
        <div class='step'>
          <p>
            The TRI does not directly regulate these chemical releases, but rather hopes to incentivize companies into improving their environmental performance by tracking and publishing this data. 
           <strong>Use the time slider below to explore total pounds released per year since reporting began in 1987. </strong>
          </p>

          <!-- total release by year D3 chart -->
          <svg id='year-chart' width='500' height='250' padding='16'></svg>

          <!-- year label and time slider -->
          <div id = 'year-label'><label id='total-year'>1987</label></div>
          <div id='sliderdiv'><input id='total-slider' type='range' min='1987' max='2018' step='1' value='0' /></div>
          
          <!-- graduated circle legend -->
          <div class='circle-legend'>
            <svg width='250' height='160'> 
              <circle fill='#cadb75' cx='65' cy='95' r='60' stroke='#2f2d2d' stroke-width='.5' /> 
              <circle fill='#cadb75' cx='65' cy='125' r='30' stroke='#2f2d2d' stroke-width='.5' /> 
              <circle fill='#cadb75' cx='65' cy='140' r='15' stroke='#2f2d2d' stroke-width='.5' /> 
              <line x1='65' y1='35' x2='150' y2='35' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <line x1='65' y1='95' x2='150' y2='95' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <line x1='65' y1='125' x2='150' y2='125' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <text class ='legend-label' x='152' y='38' class='small'>470 million</text>
              <text class ='legend-label' x='152' y='98' class='small'>128 million</text>
              <text class ='legend-label' x='152' y='128' class='small'>39 million</text>
              <text class ='legend-title' x='14' y='11'>Total pounds released annually</text>
            </svg>
          </div>
          <div id='release-note'>
            <p id='release-note'>
              Notice the big jump from 1997 to 1998.
              Seven industry sectors were added to the TRI in 1997, including metal and coal mining, electric power
              generators, and commercial hazardous waste treatment operations.
            </p>
          </div>
        </div>

        <!-- Scene 6a -->
        <div class='step'>
          <p>
            <strong>But size is not the only determining factor in how dangerous a chemical release is.</strong>
          </p>
        </div>

        <!-- Scene 7 -->
        <div class='step'>
          <p>
            <strong>The Risk-Screening Environmental Indicators (RSEI) model is used to  
            identify specific facilities or chemicals that may pose a greater risk. </strong>
            RSEI scores also consider a chemical’s toxicity, its fate and transport through the environment, and the
            size and location of the exposed population.
          </p>
          <p>
            <strong>Chromium and chromium compounds posed the greatest risk in 2018, composing 39.1% of the country's total
            RSEI score.</strong>
          </p>

          <!-- graduated circle legend for chromium/chromium compounds -->
          <div class='chemical-legend'>
            <svg width='600' height='175'> 
              <circle fill='#66C5CC' cx='75' cy='110' r='60' stroke='#2f2d2d' stroke-width='.5' /> 
              <circle fill='#66C5CC' cx='75' cy='141' r='30' stroke='#2f2d2d' stroke-width='.5' /> 
              <circle fill='#66C5CC' cx='75' cy='156' r='15' stroke='#2f2d2d' stroke-width='.5' /> 
              <line x1='75' y1='50' x2='175' y2='50' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <line x1='75' y1='111' x2='175' y2='111' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <line x1='75' y1='142' x2='175' y2='142' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <text class ='legend-label' x='177' y='53'>3.5 million pounds</text>
              <text class ='legend-label' x='177' y='115'>778,000 pounds</text>
              <text class ='legend-label' x='177' y='147'>276,000 pounds</text>
              <text class ='legend-title' x='0' y='20'>
                Chromium/Chromium Compunds Released in 2018
              </text>
            </svg>
          </div>
          </p>
        </div>

        <!-- Scene 8 -->
        <div class='step'>
          <p>
            <strong>Ethylene oxide comes in at a close second, composing 30.5% of the country's total RSEI score. </strong>
            Long term exposure to ethylene oxide can increase risk of lymphatic and breast cancers. 
          </p>

          <!-- graduated circle legend for ethylene oxide -->
          <div class='chemical-legend'>
            <svg width='285' height='150'> 
              <circle fill='#F6CF71' cx='62' cy='90' r='50' stroke='#2f2d2d' stroke-width='.5' /> 
              <circle fill='#F6CF71' cx='62' cy='115' r='25' stroke='#2f2d2d' stroke-width='.5' /> 
              <circle fill='#F6CF71' cx='62' cy='127' r='12.5' stroke='#2f2d2d' stroke-width='.5' /> 
              <line x1='62' y1='40' x2='150' y2='40' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <line x1='62' y1='90' x2='150' y2='90' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <line x1='62' y1='115' x2='150' y2='115' stroke='#2f2d2d' stroke-width='.5' stroke-dasharray='4,4' />
              <text class ='legend-label' x='152' y='43' class='small'>57,000 pounds</text>
              <text class ='legend-label' x='152' y='93' class='small'>15,000 pounds</text>
              <text class ='legend-label' x='152' y='118' class='small'>3,000 pounds</text>
              <text class ='legend-title' x='0' y='15'>Ethylene Oxide Released in 2018</text>
            </svg>
          </div>
        </div>

        <!-- Scene 8a -->
        <div class='step'>
          <p>
            A medical sterilizer plant in the Chicago suburb of Willowbrook, Illinois was recently shut down after <strong>an
            EPA report found that ethylene oxide air emissions from the plant were increasing long-term
            cancer risks for people living up to 25 miles away from the facility.
            Sterigenics released 4,205 pounds of ethylene oxide in 2016. </strong>
            In response to public pressure, Illinois just passed legislation to phase out the use of ethylene oxide by
            2022.
          </p>
          <ul>
            <span style='background:#F89C74'></span><label>Sterigenics Willowbrook Facility</label> <br>
          </ul>
        </div>

        <!-- Scene 8b -->
        <div class='step'>
          <p>
            <strong>Texas houses the two highest emitters of ethylene oxide in 2018, with 57,090 and 42,822 pounds released each year, respectively. 
            This is more than 10 times the amount released by the Sterigenics plant in Illinois. </strong>
            Releases in Texas are actually expected to increase in the wake of findings by the Texas Commission on Environmental Quality that increase safe exposure levels.
            These findings are in direct contradiction with the EPA, who recently found ethylene oxide to be far more
            hazardous than previously thought.
          </p>
          <p class='credit'>Source: <a
            href='https://news.bloomberglaw.com/environment-and-energy/texas-revision-to-ethylene-oxide-carcinogen-draws-concern'
            target='_blank'>Texas Revision to Ethylene Oxide Carcinogen Draws Concern</a></p>
        </div>

        <!-- Scene 8c -->
        <div class='step'>
          <p>
            Louisiana has 13 ethylene oxide releasing facilities, eleven of which are located along the Mississippi
            River between Baton Rouge and New Orleans.
            <strong>The two highest emitters in Louisiana are located here and release 15,100 and 10,413 pounds annually. </strong>
          </p>
        </div>

        <!-- Scene 8d -->
        <div class='step'>
          <p>
            <strong>St. James Parish is currently the only parish in this corridor between Baton Rouge and New Orleans that
            does not have an ethylene oxide emitting facility.</strong>
          </p>
          <ul>
            <span style='background:#A5AA99'></span><label>St. James Parish</label> <br>
          </ul>
        </div>

        <!-- Scene 8e -->
        <div class='step'>
          <p>
            This will change if Formosa Chemicals wins the fight to construct a new complex near Sunshine Bridge in St.
            James Parish.
            <strong>The proposed 2,300 acre complex would be permitted to release up to 15,400 pounds of ethylene oxide
            annually, more than three times what was emitted at the now defunct Sterigenics plant in Illinois.</strong>
          </p>
          <ul>
            <span style='background:#A5AA99'></span><label>St. James Parish</label> <br>
          </ul>
          <p class='credit'>Source: <a
            href='https://www.theadvocate.com/baton_rouge/news/article_c30d4620-a1be-11e9-837c-13f09466bb79.html'
            target='_blank'>The Advocate</a></p>
        </div>

        <!-- Scene 8f -->
        <div class='step'>
          <p>
            <strong>Reassurances over the plant's safety do not ease residents who are concerned over Formosa's disreputable
            history.</strong>
          </p>
        </div>

        <!-- Scene 9 -->
        <div class='step'>
          <p>
            An explosion in 2005 at Formosa's Point Comfort, Texas plant resulted in <strong>a fire that burned for 5 days</strong> and
            forced the community of Point Comfort into a shelter-in-place order. 
            And in 2019 the company was ordered to pay a <strong>$50 million settlement to clean up plastic pellets and other
            pollutants they had been illegally dumping into Lavaca Bay and surrounding waterways.</strong>
          </p>
          <ul>
            <span style='background:#cadb75'></span><label>Formosa Point Comfort Facility</label> <br>
          </ul>
          <p class='credit'>Source: <a
            href='https://www.ehstoday.com/archive/article/21913736/lawsuit-formosas-negligence-caused-propylene-blast'
            target='_blank'>Lawsuit: Formosa's Negligence Caused Propylene Blast</a> and <a
            href='https://www.texastribune.org/2019/10/15/formosa-plastics-pay-50-million-texas-clean-water-act-lawsuit/'
            target='_blank'>The Texas Tribune</a></p>
        </div>

        <!-- Scene 9a -->
        <div class='step'>
          <p>
            The Formosa Point Comfort Facility is owned by Formosa Plastics Corporation, which is headquarterd in Taiwan. 
            <strong>Companies responsible for industrial pollution are often located far from the damage they inflict on
            communities.</strong>
          </p>
        </div>

        <!-- Scene 10 -->
        <div class='step'>
          <p>
            <strong>The locations seen here represent the top 10 parent companies who own at least 90 facilities who report to
            the TRI.</strong>
          </p>
          <ul>
            <span style='background:#ED645A'></span><label>Parent Companies</label> <br>
          </ul>
          <p>
            <strong>Select a company from the dropdown to explore parent company headquarters in relation to the facilities
            they own.</strong>
          </p>

          <!-- parent company dropdown menu -->
          <div class='dropdown show'></div>
          <a class='btn btn-secondary btn-lg dropdown-toggle' href='href=javascript:return false;' role='button'
            id='parent-button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>
            Choose a company
          </a>
          <div class='dropdown-menu' id='parent-dropdown' aria-labelledby='parent-button'></div>

          <!-- company name and industry that updates according to dropdown selection -->
          <div id='company-header'></div>
          <div id='company-details'></div>
        </div>

        <!-- Scene 11 -->
        <div class='step'>
          <p>
            <strong>We just learned about the Toxics Release Inventory, and explored facilities and the toxic chemicals they release into our air, water, and land. 
            Next we will wrap up this story by visiting West Virginia, where a chemical release in 1985 first helped fuel public outcry for the establishment of the TRI program.</strong>
          </p>
        </div>

        <!-- Scene 12 -->
        <div class='step'>
          <h2>Epilogue</h2>
        </div>

        <!-- Scene 13 -->
        <div class='step'>
          <p>
            <strong>We end in the Kanawha River Valley of West Virginia, or “Chemical Valley” as it known to some. </strong>
            This area has long been a site of mining and chemical production, and the 1985 chemical release that led to the establishment of the TRI was just one of many disasters that have occurred here over the years.
          </p>
          <ul>
            <span style='background:#cadb75'></span><label>TRI Reporting Facilities in 2018</label> <br>
          </ul>
        </div>

        <!-- Scene 13a -->
        <div class='step'>
          <p>
            <strong>The latest disaster to occur here took place in 2014, when approximately 5,000 gallons of crude 4-Methylcyclohexanemethanol (MCHM) spilled into the Elk River, a tributary of the Kanawha River. </strong>
            MCHM is used as cleansing agent to remove impurities from coal that contribute to pollution during combustion. 
            The spill originated from a storage tank at Freedom Industries, a chemical storage facility that does not qualify for TRI reporting.
          </p>
          <ul>
            <span style='background:#cadb75'></span><label>TRI Reporting Facilities in 2018</label> <br>
          </ul>
          <p>
            <strong>This facility did not qualify for TRI reporting because it did not technically produce or release any chemicals, it only stored them.</strong>
          </p>
          <p class='credit'>Source: <a
            href='https://www.cnn.com/2014/01/13/us/west-virigina-chemical-contamination/'
            target='_blank'>West Virginia chemical spill shines spotlight on loose regulation</a></p>
        </div>


        <!-- Scene 13b -->
        <div class='step'>
          <p>
            The spill occurred upstream from the primary West Virginia American Water intake center, <strong>leaving 300,000
            residents in nine counties without water for several days. </strong>
            The National Guard was called in to help distribute water as water bottles quickly disappeared from store shelves, schools and businesses shut down, and hospitals struggled.
          </p>
          <ul>
            <span style='background:#A5AA99'></span><label>Affected Counties</label> <br>
          </ul>
        </div>

        <!-- Scene 13c -->
        <div class='step'>
          <p>
            The TRI tracks releases of chemicals into the environment, but how was a 46,000 gallon chemical storage tank sitting 1.5-miles up upstream from a water intake center overlooked? 
            <strong>This incident emphasizes not only the importance of tracking chemicals being released into the environment, but also exposes flaws in the regulatory system and reminds us of our vulnerability to disasters such as these.</strong>
          </p>
          <ul>
            <span style='background:#A5AA99'></span><label>Affected Counties</label> <br>
          </ul>
        </div>


        <!-- Scene 14 -->
        <div class='step'>
          <p>
            The same rivers we depend on for clean drinking water also tend to be ideal locations for many of these industries producing and releasing toxic chemicals. 
            <strong>Facilities seen here are located with one-mile of a river. </strong>
          </p>
          <ul>
            <span style='background:#79a7ac'></span><label>Rivers</label> <br>
            <span style='background:#cadb75'></span><label>TRI Reporting Facilities in 2018, located with one-mile of a river</label> <br>
          </ul>
          <p>The Superfund case studies showed us the lasting and widespread damage industrial pollution can cause when left unchecked. 
            And while the TRI does track toxic chemical releases, it cannot always protect communities or the environment, especially if regulatory laws are not enforced. 
            <strong>Industrial pollution is an issue that affects everyone, and we must continue to advocate for the health of our communities and our environment.</strong>
          </p>
          <p>
            <strong>More resources:</strong>
          </p>
          <ul>
            <li><a href='https://www.epa.gov/superfund' target='_blank'>EPA Superfund</a></li>
            <li><a href='https://www.nytimes.com/topic/subject/superfund' target='_blank'>Superfund Site News from the New York Times</a></li>
            <li><a href='https://www.epa.gov/toxics-release-inventory-tri-program' target='_blank'>Toxics Release Inventory (TRI) Program</a></li>
            <li><a href='https://www.propublica.org/series/polluters-paradise' target='_blank'>Polluter's Paradise: Environmental Impact in Louisiana</a></li>
            <li><a href='https://www.wvpublic.org/term/elk-river-chemical-spill#stream/0' target='_blank'>Elk River Chemical Spill</a></li>
            <li><a href='https://projects.propublica.org/represent/bills/category/environmental-protection' target='_blank'>Bills on Environmental Protection in the 116th Congress</a></li>

          </ul>
        </div>

      </article>

    </section>

    <!-- Scrollytelling Outro -->
    <section id='outro'>
      <p class='outro-text' style='text-align : center'>Map authored by <a href='https://eileengrady.github.io/' target='_blank'>Eileen Grady</a></p>
      <p class='outro-text' style='text-align : center'>Visit the <a href='https://github.com/EileenGrady/us-industrial-pollution' target='_blank'>project repo.</a></p>
      <p class='outro-text' style='text-align : center'><a href='#'>Jump to top of page</a></p>
    </section>

    

  </main>


  </section>

  <!-- Placed at the end of the document so the pages load faster -->
  <script src='https://code.jquery.com/jquery-3.2.1.slim.min.js'
    integrity='sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN' crossorigin='anonymous'>
  </script>
  <script src='vendor/bootstrap/js/bootstrap.bundle.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
  <script src='https://unpkg.com/d3@5.9.1/dist/d3.min.js'></script>
  <script src='https://d3js.org/d3-fetch.v1.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/scrollama/2.2.1/scrollama.min.js'></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js'></script>
  <script src='https://unpkg.com/@turf/turf/turf.min.js'></script>

  <script>

    // code to make intro screen full page on load
    var introEl = $('div.container'),
      introHeadingH = introEl.find('h1').height(),
      windowH = $(window).height();

    introEl.css('padding', (windowH - introHeadingH) / 2 + 'px 0');

    // When the user scrolls the page, execute myFunction
    window.onscroll = function() {myFunction()};

    // function to update progress bar on scroll
    function myFunction() {
      var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      var scrolled = (winScroll / height) * 100;
      document.getElementById('myBar').style.width = scrolled + '%';
    }

    // Create a scrollama object.
    var myScrollama = scrollama();

    // Set the size of the figure and the height of the steps
    // These are set to constants to improve performance on mobile devices, while keeping the code relatively simple.
    const figureHeight = window.innerHeight * 0.8
    const figureMarginTop = 0
    const stepH = Math.floor(window.innerHeight * 1.8);

    // Save different parts of the page as D3.js objects to use later for styling
    var figure = d3.select('figure');
    var article = d3.select('article');
    var steps = d3.selectAll('.step');

    // Create a function which sets the styling of the various elements
    function handleResize() {

      // update height, margin, and layering of the figure
      figure
        .style('height', figureHeight + 'px')
        .style('top', figureMarginTop + 'px')
        .style('z-index', 1);

      // force the article to appear on top of the figure
      article.style('z-index', 2);

      // tell scrollama to update new element dimensions. Not always necessary, but included just to be safe.
      myScrollama.resize();
    }

    // Create a function to update the map in response to step-triggers
    // set map view, remove/add layers, set filters, etc.
    function handleStepChange(response) {

      // create array of layers to be turned off in each case before adding back relevant layers
      const allLayers = ['superfund-layer', 'superfund-labels', 'tri-layer', 'ge-layer', 'watershed-layer',
        'river-layer', 'lead-belt-area-layer', 'tri-release-layer', 'ethylene-layer', 'sterigenics-layer', 'chromium-layer',
        'st-james-layer', 'spill-layer', 'tri-river-layer', 'parent-co-layer', 'all-rivers-layer'
      ]

      // create array of individual markers to be removed in each case before adding back relevant markers
      const allMarkers = [freedomMarker, sunshineMarker]

      switch (response.index) {
        case 0:
          // Scene 1
          // Country level, superfund sites
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-layer', null);
          map.setPaintProperty('superfund-layer', 'circle-radius', 2.5)
          document.getElementById('map').style.opacity = '0.25';
          break;

        case 1:
          // Scene 1a
          // Country level, superfund sites--repeat
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-layer', null);
          map.setPaintProperty('superfund-layer', 'circle-radius', 2.5)
          document.getElementById('map').style.opacity = '1';
          break;

        case 2:
          // Scene 1b
          // Country level, superfund sites--repeat
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-layer', null);
          map.setPaintProperty('superfund-layer', 'circle-radius', 2.5)
          map.setPaintProperty('superfund-layer', 'circle-opacity', 0.7)
          break;

        case 3:
          // Scene 2
          // Zoom to Big River Mine site
          map.flyTo({
            center: [-90.56398, 37.878471],
            zoom: 12.008,
            pitch: 0,
            bearing: 0,
            speed: .5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-layer', ['==', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.']);
          map.setPaintProperty('superfund-layer', 'circle-radius', 6);
          map.setPaintProperty('superfund-layer', 'circle-opacity', 0.9)
          break;

        case 4:
          // Scene 2a
          // Big River mine site--repeat, bring in label
          map.flyTo({
            center: [-90.56398, 37.878471],
            zoom: 12.008,
            pitch: 0,
            bearing: 0,
            speed: .5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-labels', ['==', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.']);
          map.setLayoutProperty('superfund-labels', 'visibility', 'visible');
          break;

        case 5:
          // Scene 2b
          // Big River and watershed
          map.flyTo({
            center: [-90.443955, 37.9462768],
            zoom: 9.4,
            pitch: 38.7622,
            bearing: -130.9851,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setLayoutProperty('watershed-layer', 'visibility', 'visible');
          map.setFilter('watershed-layer', ['==', 'NAME', 'Big']);
          map.setFilter('superfund-labels', ['==', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.']);
          map.setLayoutProperty('superfund-labels', 'visibility', 'visible');
          map.setLayoutProperty('river-layer', 'visibility', 'visible');
          map.setFilter('river-layer', ['==', 'name', 'Big River']);
          map.setFilter('superfund-layer', ['in', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.']);
          break;

        case 6:
          // Scene 2c
          // Bring in other Missouri lead mine superfund sites
          map.flyTo({
            center: [-90.99550, 37.9047369],
            zoom: 8.88,
            pitch: 0,
            bearing: 0,
            speed: 0.1
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-layer', ['in', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.',
            'WASHINGTON COUNTY LEAD DISTRICT - FURNACE CREEK', 'WASHINGTON COUNTY LEAD DISTRICT - POTOSI',
            'WASHINGTON COUNTY LEAD DISTRICT - OLD MINES', 'WASHINGTON COUNTY LEAD DISTRICT - RICHWOODS',
            'SOUTHWEST JEFFERSON COUNTY MINING', 'ANSCHUTZ - MADISON MINE'
          ]);
          map.setLayoutProperty('superfund-labels', 'visibility', 'visible');
          map.setFilter('superfund-labels', ['in', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.',
            'WASHINGTON COUNTY LEAD DISTRICT - FURNACE CREEK', 'WASHINGTON COUNTY LEAD DISTRICT - POTOSI',
            'WASHINGTON COUNTY LEAD DISTRICT - OLD MINES', 'WASHINGTON COUNTY LEAD DISTRICT - RICHWOODS',
            'SOUTHWEST JEFFERSON COUNTY MINING', 'ANSCHUTZ - MADISON MINE'
          ]);
          map.setLayoutProperty('watershed-layer', 'visibility', 'visible');
          map.setLayoutProperty('river-layer', 'visibility', 'visible');
          break;

        case 7:
          // Scene 2d
          // Bring in affected county outlines
          map.flyTo({
            center: [-91.19849, 37.889413],
            zoom: 8.3,
            pitch: 0,
            bearing: 0,
            speed: .1
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setLayoutProperty('watershed-layer', 'visibility', 'visible');
          map.setLayoutProperty('lead-belt-area-layer', 'visibility', 'visible');
          map.setLayoutProperty('river-layer', 'visibility', 'visible');
          break;

        case 8:
          // Scene 2e
          // counties affected--repeat before transition to next case study
          map.flyTo({
            center: [-91.19849, 37.889413],
            zoom: 8.3,
            pitch: 0,
            bearing: 0,
            speed: .25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setLayoutProperty('watershed-layer', 'visibility', 'visible');
          map.setFilter('watershed-layer', ['==', 'NAME', 'Big']);
          map.setFilter('superfund-layer', ['in', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.',
            'WASHINGTON COUNTY LEAD DISTRICT - FURNACE CREEK', 'WASHINGTON COUNTY LEAD DISTRICT - POTOSI',
            'WASHINGTON COUNTY LEAD DISTRICT - OLD MINES', 'WASHINGTON COUNTY LEAD DISTRICT - RICHWOODS',
            'SOUTHWEST JEFFERSON COUNTY MINING', 'ANSCHUTZ - MADISON MINE'
          ]);
          map.setLayoutProperty('lead-belt-area-layer', 'visibility', 'visible');
          map.setLayoutProperty('river-layer', 'visibility', 'visible');
          map.setFilter('river-layer', ['==', 'name', 'Big River']);
          break;

        case 9:
          // Scene 3
          // Fly to GE Pittsfield Site
          map.flyTo({
            center: [-73.2420, 42.4483],
            zoom: 14,
            pitch: 0,
            bearing: 0,
            speed: 0.5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-layer', ['==', 'SITE_NAME', 'GE PITTSFIELD HOUSATONIC RIVER SUPERFUND SITE']);
          break;

        case 10:
          // Scene 3a
          // GE Pittsfield Site--repeat, bring in label
          map.flyTo({
            center: [-73.2420, 42.4483],
            zoom: 14,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-labels', ['==', 'SITE_NAME', 'GE PITTSFIELD HOUSATONIC RIVER SUPERFUND SITE']);
          map.setLayoutProperty('superfund-labels', 'visibility', 'visible');
          break;

        case 11:
          // Scene 3b
          // Full GE site extent map
          map.flyTo({
            center: [-73.23815, 42.4546],
            zoom: 13.5,
            pitch: 0,
            bearing: 0,
            speed: .1
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setLayoutProperty('ge-layer', 'visibility', 'visible');
          break;

        case 12:
          // Scene 3c
          // Housatonic River and watershed
          map.flyTo({
            center: [-73.672497, 41.75147],
            zoom: 8.8,
            pitch: 56.5,
            bearing: 36.68659,
            speed: .3
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('river-layer', 'visibility', 'visible');
          map.setFilter('river-layer', ['in', 'name', 'Housatonic River', 'East Branch Housatonic River']);
          map.setLayoutProperty('watershed-layer', 'visibility', 'visible');
          map.setFilter('watershed-layer', ['==', 'NAME', 'Housatonic']);
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-layer', ['==', 'SITE_NAME', 'GE PITTSFIELD HOUSATONIC RIVER SUPERFUND SITE']);
          map.setPaintProperty('superfund-layer', 'circle-radius', 6);
          map.setPaintProperty('superfund-layer', 'circle-opacity', 0.9)
          document.getElementById('map').style.opacity = '1';
          break;

        case 13:
          // Scene 4
          // Country level, all Superfund sites, conclusion
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0,
            speed: 0.5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('superfund-layer', 'visibility', 'visible');
          map.setFilter('superfund-layer', null);
          map.setPaintProperty('superfund-layer', 'circle-radius', 2.5)
          map.setPaintProperty('superfund-layer', 'circle-opacity', 0.7)
          document.getElementById('map').style.opacity = '1';
          break;

        case 14:
          // Scene 5
          // country level, overall TRI facility distribution
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-layer', 'visibility', 'visible');
          map.setFilter('tri-layer', null);
          map.setPaintProperty('tri-layer', 'circle-radius', 2);
          document.getElementById('map').style.opacity = '0.25';
          break;

        case 15:
          // Scene 5a
          // country level, overall TRI facility distribution--repeat
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-layer', 'visibility', 'visible');
          map.setFilter('tri-layer', null);
          map.setPaintProperty('tri-layer', 'circle-radius', 2);
          document.getElementById('map').style.opacity = '1';
          break;

        case 16:
          // Scene 6
          // TRI top releasing facilities with time slider
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-release-layer', 'visibility', 'visible');
          map.setPaintProperty('tri-release-layer', 'circle-color', '#cadb75');

          // reset time slider to beginning
          document.getElementById('total-slider').value = 0;
          filterTotalRelease(1987)
          document.getElementById('release-note').style.fontWeight = 'normal';

          // set bar chart to highlight first bar at start
          d3.selectAll('.bar')
            .filter(function (d) {
              return d.YEAR == 1987;
            })
            .attr('opacity', 1)
            .attr('fill', '#A1AF5D');
          break;

        case 17:
          // Scene 6a
          // TRI top releasing facilities--repeat for transition
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-release-layer', 'visibility', 'visible');
          map.setPaintProperty('tri-release-layer', 'circle-color', '#cadb75');
          document.getElementById('release-note').style.fontWeight = 'normal';
          break;

        case 18:
          // Scene 7
          // country level, chromium facilities
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('chromium-layer', 'visibility', 'visible');
          break;

        case 19:
          // Scene 8
          // country level, ethylene oxide facilitiies
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('ethylene-layer', 'visibility', 'visible');
          break;

        case 20:
          // Scene 8a
          // Fly to Willowbrook, Illinois, defunct Sterigenics Facility
          map.flyTo({
            center: [-88.34949, 41.82125],
            zoom: 8.8627,
            pitch: 0,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('sterigenics-layer', 'visibility', 'visible');
          map.setLayoutProperty('ethylene-layer', 'visibility', 'visible');
          break;

        case 21:
          // Scene 8b
          // Fly to Texas, ethylene oxide facilities
          map.flyTo({
            center: [-96.9906, 29.4035],
            zoom: 6.789,
            pitch: 0,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('ethylene-layer', 'visibility', 'visible');
          break;

        case 22:
          // Scene 8c
          // Fly to Louisiana, ethylene oxide facilities
          map.flyTo({
            center: [-91.8152, 30.1678],
            zoom: 7.7827,
            pitch: 0,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('ethylene-layer', 'visibility', 'visible');
          break;

        case 23:
          // Scene 8d
          // Bring in St. James Parish
          map.flyTo({
            center: [-91.0835, 30.0772],
            zoom: 8.78,
            pitch: 0,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('ethylene-layer', 'visibility', 'visible');
          map.setLayoutProperty('st-james-layer', 'visibility', 'visible');
          break;

        case 24:
          // Scene 8e
          // add marker showing proposed Formosa facility
          map.flyTo({
            center: [-91.0835, 30.0772],
            zoom: 9.78,
            pitch: 057,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('ethylene-layer', 'visibility', 'visible');
          map.setLayoutProperty('st-james-layer', 'visibility', 'visible');
          map.once('moveend', function (e) {
            sunshineMarker.addTo(map);
          });
          break;

        case 25:
          // Scene 8f
          // add marker showing proposed Formosa facility--repeat for transition
          map.flyTo({
            center: [-91.0835, 30.0772],
            zoom: 9.78,
            pitch: 057,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('ethylene-layer', 'visibility', 'visible');
          map.setLayoutProperty('st-james-layer', 'visibility', 'visible');
          sunshineMarker.addTo(map);
          break;

        case 26:
          // Scene 9
          // Fly to Formosa Point Comfort Facility
          map.flyTo({
            center: [-96.6307, 28.6309],
            zoom: 11.97,
            pitch: 56.6538,
            bearing: 20,
            speed: 0.5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-layer', 'visibility', 'visible');
          map.setFilter('tri-layer', ['==', 'FACILITY NAME', 'FORMOSA PLASTICS CORP TEXAS']);
          map.setPaintProperty('tri-layer', 'circle-radius', 8);
          map.setPaintProperty('tri-layer', 'circle-opacity', 0.9)
          break;

        case 27:
          // Scene 9a
          // Formosa Point Comfort Facility--repeat for transition
          map.flyTo({
            center: [-96.6307, 28.6309],
            zoom: 11.97,
            pitch: 56.6538,
            bearing: 20,
            speed: 0.5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-layer', 'visibility', 'visible');
          map.setFilter('tri-layer', ['==', 'FACILITY NAME', 'FORMOSA PLASTICS CORP TEXAS']);
          map.setPaintProperty('tri-layer', 'circle-radius', 8);
          map.setPaintProperty('tri-layer', 'circle-opacity', 0.9)
          break;

        case 28:
          // Scene 10
          // Country level, parent companies with dropdown selection menu
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('parent-co-layer', 'visibility', 'visible');
          map.setPaintProperty('tri-layer', 'circle-radius', 4)
          map.setPaintProperty('tri-layer', 'circle-opacity', 0.65)
          map.setFilter('parent-co-layer', null);
          $('#company-header').text('Parent Company')
          $('#company-details').text('Industry')
          if (map.getSource('company-line-source')) {
            map.removeLayer('company-line-layer')
            map.removeSource('company-line-source')
          };
          break;

        case 29:
          // Scene 11
          // Country level, all TRI facilities, conclusion
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0,
            speed: 0.5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-layer', 'visibility', 'visible');
          map.setFilter('tri-layer', null);
          map.setPaintProperty('tri-layer', 'circle-radius', 2);
          document.getElementById('map').style.opacity = '1';
          if (map.getSource('company-line-source')) {
            map.removeLayer('company-line-layer')
            map.removeSource('company-line-source')
          };
          break;

        case 30:
          // Scene 12
          // Epilogue introduction, all TRI facilities
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0,
            speed: 0.5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-layer', 'visibility', 'visible');
          map.setFilter('tri-layer', null);
          map.setPaintProperty('tri-layer', 'circle-radius', 2);
          document.getElementById('map').style.opacity = '0.25';
          if (map.getSource('company-line-source')) {
            map.removeLayer('company-line-layer')
            map.removeSource('company-line-source')
          };
          break;

        case 31:
          // Scene 13
          // Fly to Chemical Valley, West Virginia
          map.flyTo({
            center: [-81.8162, 38.3771],
            zoom: 11.115,
            pitch: 59.5,
            bearing: 0,
            speed: 0.75
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-layer', 'visibility', 'visible');
          map.setPaintProperty('tri-layer', 'circle-radius', 4);
          document.getElementById('map').style.opacity = '1';
          break;

        case 32:
          // Scene 13a
          // Zoom to Freedom Industries facility, location of 2014 chemical spill
          map.flyTo({
            center: [-81.666488, 38.359746],
            zoom: 12.115,
            pitch: 26.5,
            bearing: -7.999,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-layer', 'visibility', 'visible');
          map.once('moveend', function (e) {
            freedomMarker.addTo(map);
          });
          break;

        case 33:
          // Scene 13b
          // show counties affected by spill
          map.flyTo({
            center: [-82.3395, 38.4080],
            zoom: 8,
            pitch: 0,
            bearing: 0,
            speed: 0.5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('spill-layer', 'visibility', 'visible');
          freedomMarker.addTo(map);
          break;

        case 34:
          // Scene 13c
          // show counties affected by spill--repeat for transition
          map.flyTo({
            center: [-82.3395, 38.4080],
            zoom: 8,
            pitch: 0,
            bearing: 0,
            speed: 0.5
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('spill-layer', 'visibility', 'visible');
          freedomMarker.addTo(map);
          break;

        case 35:
          // Scene 14
          // country level, facilities within one mile of a river
          map.flyTo({
            center: [-118.033395, 38.312143],
            zoom: 3.5,
            pitch: 0,
            bearing: 0,
            speed: 0.25
          });
          allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
          allMarkers.forEach(item => item.remove());
          map.setLayoutProperty('tri-river-layer', 'visibility', 'visible');
          map.setLayoutProperty('all-rivers-layer', 'visibility', 'visible');
          break;

        default:
          // do nothing

      }

    }

    // Create a function that will run just once that first makes sure all the elements are sized like you want them,
    // and then sets up the scrollama. Finally, add an event listener to detect if the screen size has changed.
    function init() {

      // force a resize on load to ensure proper dimensions are sent to scrollama
      handleResize();

      // Setup the scrollama
      myScrollama.setup({
        step: '.step',
        offset: Math.floor(window.innerHeight) * 0.95 + 'px',
        // set to true to see debug horizontal line
        // debug: true,
      }).onStepEnter(handleStepChange)

      // setup resize event
      window.addEventListener('resize', handleResize);
    }

    // add mapbox access token
    mapboxgl.accessToken =
      'pk.eyJ1IjoiZWlsZWVuZ3JhZHkiLCJhIjoiY2pvNG00eXVjMDFlcjNxcW1yZ3I2OTJ2ZSJ9.l2EtBykdOJSCNiszd2NbaA';

    // initalize map
    var map = new mapboxgl.Map({
      container: 'map', // container id
      style: 'mapbox://styles/eileengrady/ck9vlhb4417hl1iqmcr1eoyr4', // stylesheet location
      center: [-118.033395, 38.312143], // starting position [lng, lat]
      zoom: 3.5, // starting zoom
      scrollZoom: false
    });

    // create zoom control
    map.addControl(new mapboxgl.NavigationControl());

    // create marker for Freedom Industries in WV
    var freedomMarker = new mapboxgl.Marker()
      .setLngLat([-81.606774, 38.368888])

    // create marker for Formosa Chemical plant near Sunshine bridge
    var sunshineMarker = new mapboxgl.Marker()
      .setLngLat([-90.910054, 30.057623])

    map.on('load', function () {

      // add source and layer for GE Pittsfield site map
      map.addSource('ge-source', {
        type: 'geojson',
        data: 'data/map-data/ge-site-area.geojson'
      });

      map.addLayer({
        'id': 'ge-layer',
        'type': 'line',
        'source': 'ge-source',
        'layout': {
          'visibility': 'none'
        },
        'paint': {
          'line-color': '#D3B484',
          'line-width': 1.5
        }
      });

      // add source and layer for watershed layer
      map.addSource('watershed-source', {
        type: 'geojson',
        data: 'data/map-data/watersheds.geojson'
      });

      map.addLayer({
        'id': 'watershed-layer',
        'type': 'fill',
        'source': 'watershed-source',
        'layout': {
          'visibility': 'none'
        },
        'paint': {
          'fill-color': '#44AA99',
          'fill-opacity': .4,
          'fill-outline-color': '#52BCA3',
        }
      }, 'superfund-layer');

      // move watershed layer behind Superfund site labels
      map.moveLayer('watershed-layer', 'superfund-labels');

      // add source and layer for river layer used in case studies
      map.addSource('river-source', {
        type: 'geojson',
        data: 'data/map-data/case-study-rivers.geojson'
      });

      map.addLayer({
        'id': 'river-layer',
        'type': 'line',
        'source': 'river-source',
        'layout': {
          'visibility': 'none'
        },
        'paint': {
          'line-color': '#88CCEE',
          'line-width': 2
        }
      }, 'superfund-layer');

      // move river layer behind Superfund site labels
      map.moveLayer('river-layer', 'superfund-labels');

      // add source and layer for counties affected in Missouri Lead District
      map.addSource('lead-belt-area-source', {
        type: 'geojson',
        data: 'data/map-data/missouri-lead-counties.geojson'
      });

      map.addLayer({
        'id': 'lead-belt-area-layer',
        'type': 'line',
        'source': 'lead-belt-area-source',
        'layout': {
          'visibility': 'none'
        },
        'paint': {
          'line-color': '#A5AA99',
          'line-width': 1.5
        }
      });

      // add source and layer for chromium facilities
      map.addSource('chromium-source', {
        type: 'geojson',
        data: 'data/map-data/chromium-facilities.geojson'
      });

      map.addLayer({
        'id': 'chromium-layer',
        'type': 'circle',
        'source': 'chromium-source',
        'layout': {
          'visibility': 'none'
        },
        'paint': {
          'circle-color': '#66C5CC',
          'circle-radius': [
            'sqrt', ['/', ['get', 'ON_SITE_RELEASE_TOTAL'], 1000]
          ],
          'circle-opacity': .75,
          'circle-stroke-color': '#2f2d2d',
          'circle-stroke-width': 0.5,
        }
      });

      // add source and layer for ethylene oxide facilities
      map.addSource('ethylene-source', {
        type: 'geojson',
        data: 'data/map-data/ethylene-facilities.geojson'
      });

      map.addLayer({
        'id': 'ethylene-layer',
        'type': 'circle',
        'source': 'ethylene-source',
        'layout': {
          'visibility': 'none'
        },
        'filter': ['!=', 'FACILITY_NAME', 'STERIGENICS US LLC-WILLOWBROOK IL FACILITY'],
        'paint': {
          'circle-color': '#F6CF71',
          'circle-radius': [
            'sqrt', ['/', ['get', 'ON_SITE_RELEASE_TOTAL'], 25]
          ],
          'circle-opacity': .75,
          'circle-stroke-color': '#2f2d2d',
          'circle-stroke-width': 0.5
        },
      });

      // add Sterigenics facility layer
      map.addLayer({
        'id': 'sterigenics-layer',
        'type': 'circle',
        'source': 'ethylene-source',
        'layout': {
          'visibility': 'none'
        },
        'filter': ['==', 'FACILITY_NAME', 'STERIGENICS US LLC-WILLOWBROOK IL FACILITY'],
        'paint': {
          'circle-color': '#F89C74',
          'circle-radius': [
            'sqrt', ['/', ['get', 'ON_SITE_RELEASE_TOTAL'], 25]
          ],
          'circle-opacity': .75,
          'circle-stroke-color': '#2f2d2d',
          'circle-stroke-width': 0.5
        },
      });

      // add source and layer for St. James Parish
      map.addSource('st-james-source', {
        type: 'geojson',
        data: 'data/map-data/st-james-parish.geojson'
      });

      map.addLayer({
        'id': 'st-james-layer',
        'type': 'line',
        'source': 'st-james-source',
        'layout': {
          'visibility': 'none'
        },
        'paint': {
          'line-color': '#A5AA99',
          'line-width': 1.5
        }
      });

      // add source and layer for counties affected by Freedom Industry spill
      map.addSource('spill-source', {
        type: 'geojson',
        data: 'data/map-data/elk-river-spill-counties.geojson'
      });

      map.addLayer({
        'id': 'spill-layer',
        'type': 'line',
        'source': 'spill-source',
        'layout': {
          'visibility': 'none'
        },
        'paint': {
          'line-color': '#A5AA99',
          'line-width': 1.5
        }
      });

      // add source and layer for parent companies
      map.addSource('parent-co-source', {
        type: 'geojson',
        data: 'data/map-data/parent-companies.geojson'
      });

      map.addLayer({
        'id': 'parent-co-layer',
        'type': 'circle',
        'source': 'parent-co-source',
        'layout': {
          'visibility': 'none'
        },
        'paint': {
          'circle-color': '#ED645A',
          'circle-radius': 5,
          'circle-stroke-color': '#2f2d2d',
          'circle-stroke-width': .5,
          'circle-opacity': .9
        }
      });

      // call function to initiate scrollama
      init();

      // draw yearly release total chart
      drawYearChart();

      // call function to create and populate parent company filter
      addCompanyFilter()

    })

    // declare function that draws d3 chart for yearly release totals
    function drawYearChart() {

      var width = 575,
          height = 250,
          padding =  {top:0, right: 5, bottom: 35, left: 40}

      var svg = d3.select('#year-chart')
          .append('svg')
          .attr('width', width)
          .attr('height', height);

      var xScale = d3.scaleBand().range([0, width]).padding(0.2),
          yScale = d3.scaleLinear().range([height, 0]).clamp(false);;

      d3.csv('data/map-data/year-totals.csv').then(function (data) {

        var xScale = d3.scaleBand()
          .domain(data.map(function (d) {
            return d.YEAR;
          }))
          .range([padding.left * 2, width - padding.right])
          .padding(0.2);

        var yScale = d3.scaleLinear()
          .domain([0, d3.max(data, function (d) {
            return d.TOTAL_RELEASE;
          })])
          .range([height - padding.top - padding.bottom, padding.right]);

        svg.append('g')
          .attr('class', 'grid')
          .attr('transform', 'translate(' + padding.left * 2 + ',0)')
          .call(d3.axisLeft()
              .scale(yScale)
              .tickSize(-width, 0, 0)
              .tickFormat(''))

        var bars = svg.selectAll('.bars')
          .data(data)
          .enter().append('rect')
          .attr('class', 'bar')
          .attr('opacity', 0.55)
          .attr('x', function (d) {
            return xScale(d.YEAR);
          })
          .attr('y', function (d) {
            return yScale(d.TOTAL_RELEASE);
          })
          .attr('width', xScale.bandwidth())
          .attr('height', function (d) {
            return height - padding.bottom - yScale(d.TOTAL_RELEASE);
          })
          // .attr('fill', (d => d3.select('#total-slider').node().value == d.YEAR ? 'firebrick' : 'teal'));
          
          var formatValue = d3.format('0.2s');

          var xAxis = d3.axisBottom(xScale);
          var yAxis = d3.axisLeft(yScale);

          var gX = svg.append('g')
            .attr('transform', 'translate(0,' + (height - padding.bottom) + ')')
            .call(xAxis)
            .selectAll('text')
            .attr('transform', 'rotate(45)')
            .attr('dy', '.55em')
            .style('text-anchor', 'start');
        

          var gY = svg.append('g')
            .attr('transform', 'translate(' + padding.left * 2 + ',0)')
            .call(d3.axisLeft(yScale).tickFormat(function (d) {
              return formatValue(d).replace('G', 'B');
            }));

          svg.append('text')
            .attr('class', 'bar-chart-label')
            .attr('x', - (height / 3.8) - padding.left)
            .attr('y', padding.bottom / 1.25)
            .attr('transform', 'rotate(-90)')
            .attr('text-anchor', 'middle')
            .text('Total Pounds Released')
      });
    }

    // create array of years to use below in time slider
    var years = [
      '1987',
      '1988',
      '1989',
      '1990',
      '1991',
      '1992',
      '1993',
      '1994',
      '1995',
      '1996',
      '1997',
      '1998',
      '1999',
      '2000',
      '2001',
      '2002',
      '2003',
      '2004',
      '2005',
      '2006',
      '2007',
      '2008',
      '2009',
      '2010',
      '2011',
      '2012',
      '2013',
      '2014',
      '2015',
      '2016',
      '2017',
      '2018'
    ];

    document
      .getElementById('total-slider')
      .addEventListener('input', function (e) {
        var year = parseInt(e.target.value, 10);
        filterTotalRelease(year);
      });

     // declare function to filter facilities by year by time slider
     function filterTotalRelease(totalYear) {
      var total = 'TOTAL'
      var totalField = total.concat(totalYear)
      map.setPaintProperty('tri-release-layer', 'circle-radius', ['sqrt', ['/', ['get', totalField], 150000]]);
      map.setPaintProperty('tri-release-layer', 'circle-color', '#cadb75');

      // Set the label to the month
      document.getElementById('total-year').textContent = totalYear;

      // format release note to bold when time slider reaches 1998
      if (totalYear == '1998') {
        document.getElementById('release-note').style.fontWeight = 'bold';
      }

      // select corresponding bar in bar chart to create interaction
      d3.selectAll('.bar')
        .filter(function (d) {
          return d.YEAR == totalYear;
        })
        .transition()
        .duration(500)
        .attr('opacity', 1)
        .attr('fill', '#A1AF5D');

      // return bar to normal when slider changes to new year
      d3.selectAll('.bar')
        .filter(function (d) {
          return d.YEAR != totalYear;
        })
        .transition()
        .duration(500)
        .attr('opacity', 0.55)
        .attr('fill', '#cadb75');
    }

    // create list of parent companies
    const parentCompanies = ['US DEPARTMENT OF DEFENSE', 'BERKSHIRE HATHAWAY INC', 'CEMEX INC', 'ARGOS USA CORP',
      'KOCH INDUSTRIES INC', 'CRH AMERICAS INC', 'CLEAN HARBORS INC', 'TYSON FOODS INC', 'MARATHON PETROLEUM CORP',
      'MARTIN MARIETTA MATERIALS INC'
    ]

    // declare function to populate dropdown menu and call function to filter map
    function addCompanyFilter(company) {

      // make the selection once
      var dropdown = $('#parent-dropdown');

      // populate dropdown with company values
      //for each value in parent company array
      $.each(parentCompanies, function (key, value) {
        // append a new element
        dropdown.append("<a class='dropdown-item' value='" + key + "' href='#!''>" + value +
          "</a>") //append new dropdown item
      });

      //assign click event to dropdown filter, call filterMap when dropdown selection made
      $('.dropdown-menu a').click(function (e) {
        company = this.innerHTML;
        filterMap(company);
        updateDetails(company);
      });
    }

    // filter parent company and its TRI facilities when dropdown chanes
    function filterMap(company) {

      // check if line layer exists and remove it first
      if (map.getSource('company-line-source')) {
        map.removeLayer('company-line-layer')
        map.removeSource('company-line-source')
      };

      // set filters and properties to show chosen parent company and its facilities
      map.setFilter('parent-co-layer', ['==', 'parentCompany', company]);
      map.setPaintProperty('parent-co-layer', 'circle-radius', 8);
      map.setLayoutProperty('tri-layer', 'visibility', 'visible');
      map.setFilter('tri-layer', ['==', 'PARENT CO NAME', company]);

      // get the child facility source data
      var facilities = map.querySourceFeatures('composite', {
        sourceLayer: 'tri-2018-4g0489',
        filter: ['==', 'PARENT CO NAME', company]
      });

      // get the parent company source data
      var parent = map.querySourceFeatures('parent-co-source', {
        filter: ['==', 'parentCompany', company]
      });

      // create turf point from coordinates of parent company
      var from = turf.point([parent[0].properties.longitude, parent[0].properties.latitude]).geometry.coordinates;

      // declare empty array to populate line features with
      var lineData = []

      // for each child facility 
      facilities.forEach(function (feature) {

        // create turf point from its coordinates
        var to = turf.point([feature.properties.LONGITUDE, feature.properties.LATITUDE]).geometry.coordinates;

        // create line string from parent company location to child facility
        var line = turf.lineString([from, to]);

        // push each line string to the lineData array
        lineData.push(line)

      })

      // add new source using lineData created above
      map.addSource('company-line-source', {
        type: 'geojson',
        data: {
          'type': 'FeatureCollection',
          'features': lineData
        }
      });

      // add layer from the lineData source
      map.addLayer({
        'id': 'company-line-layer',
        'type': 'line',
        'source': 'company-line-source',
        'layout': {
          'line-join': 'round',
          'line-cap': 'round'
        },
        'paint': {
          'line-color': '#B3B3B3',
          'line-width': .5,
          'line-opacity': .5
        }
      }, 'tri-layer');

    }

    function updateDetails(company) {
      var parentCompany = map.querySourceFeatures('parent-co-source', {
        filter: ['==', 'parentCompany', company]
      });
      $('#company-header').text(parentCompany[0].properties.name)
      $('#company-details').text(parentCompany[0].properties.industry)
    }

  </script>


</body>


</html>