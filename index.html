<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Industrial Pollution</title>

    <!-- title bar -->
    <!-- <nav class="navbar navbar-dark bg-dark navbar-fixed-top">
        <span class="navbar-brand mb-0 h1">Exploring Industrial Pollution in the US</span>
    </nav> -->
    <main>
    
        <!-- OPTIONAL: Scrollytelling Intro -->
        <section id="intro">
            <p><br></p>
            <h1 style="text-align:center">Exploring Industrial Pollution in the US</h1>
            <p><br></p>
          </section>    

    <!-- Main Scrollytelling Section -->
    <section id="scrollytelling">

        <!-- Figure sticks in place and updates as the user scrolls -->
        <figure>
            <div class='chart' id="map"></div>
        </figure>
  
        <!-- Prose for the story. Each div contains the text to show about the different versions of the figure -->
        <article>
          <!-- Each div must have the class that you specify in the myScrollama.setup() -->
  
          <!-- Message #1 -->
          <div class="step">
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
          </div>
          
          <!-- Message #2 -->
          <div class="step">
            <p>Vivamus rhoncus ut dolor vitae euismod.</p>
          </div>
  
          <!-- Message #3 -->
          <div class="step">
            <p>Aliquam sodales felis sed nisl porta sodales.</p>
          </div>

  
        </article>
  
      </section>
  
      <!-- OPIONAL: Scrollytelling Outro --> 
      <section id="outro">
        <p style="text-align : center"><br><a href="#top">Jump to top of page</a><br></p>
      </section>
    
    </main>
  

    </section>
      
       

    <!-- Bootstrap core CSS -->
    <link href="vendor\bootstrap\css\bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
    <!-- Custom styles for this template -->
    <link href='css/style.css' rel='stylesheet' />
  </head>

  <body>

 
    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.js"></script>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/scrollama/2.2.1/scrollama.min.js"></script>
    <!-- <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.14.2/TweenMax.min.js"></script> -->


    <!-- <script src='js/app.js'></script> -->

    <script>

    var superfundLayer = []
    var triLayer = []       

    var map = L.map('map', {
            center: [36.686041276581925, -99.42626953125001],
            zoom: 5,
            scrollWheelZoom: false
        });

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        const superfund = d3.json('data/superfund-sites-new.geojson');
        const tri = d3.json('data/tri-facilities-new.geojson');

        Promise.all([superfund, tri]).then(dataReady)

        function dataReady(data) {

            // assign data to variables
            const superfund = data[0];
            const tri = data[1]

            // call drawMap function, passing data variables to pull out of function
            drawMap(superfund, tri)
        }

        function drawMap(superfund, tri) {
            superfundLayer = L.geoJSON(superfund, {
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, {
                        weight: 1,
                        radius: 3,
                        color: "#c8ffc8",
                        fillColor: "#66FF66",
                        fillOpacity: 1
                    })
                }
                }).addTo(map);

                triLayer = L.geoJSON(tri, {
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, {
                        weight: 1,
                        radius: 3,
                        color: "#ffad5a",
                        fillColor: "#FF9933",
                        fillOpacity: 1
                    })
                }
                }).addTo(map);


            }

 // ---------Section 0: Make a scrollama--------------- 
  // Create a scrollama object.
  // ---------------------------------------------------
  var myScrollama = scrollama();

  // ---------Section 1: Set Heights---------------
  //#region
  // Set the size of the figure and the height of the steps
  // These are set to constants to improve performance on mobile devices, while keeping the code relatively simple.
  // ----------------------------------------------
  const figureHeight = window.innerHeight * 0.8
  const figureMarginTop = (window.innerHeight - figureHeight) / 2
  const stepH = Math.floor(window.innerHeight * 1.8);
  //#endregion

  // ---------Section 2: HTML -> D3--------------- 
  //#region
  // Save different parts of the page as D3.js objects. We'll use these later for easy restyling. D3.js is used for convenience.
  // ---------------------------------------------
  var figure = d3.select('figure');
  var imgV1 = d3.select('#imgV1');
  var imgV2 = d3.select('#imgV2');
  var imgV3 = d3.select('#imgV3');

  var article = d3.select('article');
  var steps = d3.selectAll('.step');
  //#endregion

  // ---------Section 3: handleResize()---------------
  //#region
  // Create a function which sets the styling of the various elements exactly as you want it to appear
  // This function could increase in complexity as you build responsive scrollytelling webpages. Here, this function
  // is relatively simple.
  // -------------------------------------------------
  function handleResize() {
    
    console.log("handling resize")

    // 1. update height of step elements
    steps.style('height', stepH + 'px');

    // 2. update height, margin, and layering of the figure
    figure
      .style('height', figureHeight + 'px')
      .style('top', figureMarginTop + 'px')
      .style("z-index", 1);

    // 3. force the article to appear on top of the figure
    article.style("z-index", 2);

    // 4. tell scrollama to update new element dimensions. Not always necessary, but included just to be safe.
    myScrollama.resize();

  }
  //#endregion

  // ---------Section 4: handleStepChange()---------------
  // Create a function to update the figure in response to step-triggers.
  // Again, this function could get more complex as your story gets longer or updates in different ways.
  // -----------------------------------------------------
  function handleStepChange(response) {
  
    console.log(response)
    console.log(superfundLayer)

    switch(response.index) {
      case 0:
        // have both layers
        map.removeLayer(superfundLayer);
        map.removeLayer(triLayer);
        map.addLayer(superfundLayer);
        map.addLayer(triLayer);
        break;

      case 1:
        // remove both and add superfund sites
        map.removeLayer(superfundLayer);
        map.removeLayer(triLayer);
        map.addLayer(superfundLayer);
        break;

      case 2:
        // remove both and add tri facilities
        map.removeLayer(superfundLayer);
        map.removeLayer(triLayer);
        map.addLayer(triLayer);
        break;

      default:
        // do nothing
    }

  }

  // ---------Section 5: init()--------------- 
  // Create a function that will run just once that first makes sure all the elements are sized like you want them,
  // and then sets up the scrollama. Finally, add an event listener to detect if the screen size has changed.
  // -----------------------------------------
  function init() {

    // 1. force a resize on load to ensure proper dimensions are sent to scrollama
    handleResize();

    // 2. Setup the scrollama
    myScrollama.setup({
      step: '.step',
      offset: Math.floor(window.innerHeight) * 0.95 + "px",
      // set to true to see debug horizontal line
      debug: true,
    }).onStepEnter(handleStepChange)
      
    // setup resize event
    window.addEventListener('resize', handleResize);
  }


  // ---------Section 6: Wrap Up--------------- 
  // This is where you'll want to include any other JavaScript that you've created for the webpage, and to run the init() function. 
  // ------------------------------------------
  init();
 
        

        // var map = L.map('map', {
        //     center: [36.686041276581925, -99.42626953125001],
        //     zoom: 5,
        //     scrollWheelZoom: false
        // });

        // L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        //     attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        //     subdomains: 'abcd',
        //     maxZoom: 19
        // }).addTo(map);

        // const superfund = d3.json('data/superfund-sites-new.geojson');
        // const tri = d3.json('data/tri-facilities-new.geojson');

        // Promise.all([superfund, tri]).then(dataReady)

        // function dataReady(data) {

        //     // assign data to variables
        //     const superfund = data[0];
        //     const tri = data[1]

        //     // call drawMap function, passing data variables to pull out of function
        //     drawMap(superfund)
        // }

        // function drawMap(superfund) {
        //     var superfundLayer = L.geoJSON(superfund, {
        //         pointToLayer: function (feature, latlng) {
        //             return L.circleMarker(latlng, {
        //                 weight: 1,
        //                 radius: 3,
        //                 color: "#c8ffc8",
        //                 fillColor: "#66FF66",
        //                 fillOpacity: 1
        //             })
        //         }
        //         }).addTo(map);

        //         var triLayer = L.geoJSON(tri, {
        //         pointToLayer: function (feature, latlng) {
        //             return L.circleMarker(latlng, {
        //                 weight: 1,
        //                 radius: 3,
        //                 color: "#ffad5a",
        //                 fillColor: "#FF9933",
        //                 fillOpacity: 1
        //             })
        //         }
        //         });
        //     }
    
        


    
    </script>

    
  </body>
</html>
