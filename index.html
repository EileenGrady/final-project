<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Industrial Pollution</title>

    <!-- title bar -->
    <!-- <nav class="navbar navbar-dark bg-dark navbar-fixed-top">
        <span class="navbar-brand mb-0 h1">Exploring Industrial Pollution in the US</span>
    </nav> -->
    <main>
    
        <!-- OPTIONAL: Scrollytelling Intro -->
        <section id="intro">
          <div class = "container">
            <h1>Exploring Industrial Pollution in the US</h1>
            <h2>In 1969, the burning of the Cuyahoga River in Cleveland, Ohio became a national symbol for the public’s outcry against industrial pollution. The public had been expressing increasing concern throughout the 1950s and 1960s, and the US reached a turning point when the Environmental Protection Agency was established in 1970. The EPA began to monitor and enforce the increasing number of environmental laws passed by Congress aimed at reducing industrial pollution. Today there are two main programs in place that monitor industrial pollution in the United States.</h2>
            <!-- <p><br></p> -->
          </div>
          </section>    

    <!-- Main Scrollytelling Section -->
    <section id="scrollytelling">

        <!-- Map  -->
        <figure>
            <div id="map">
            </div>
            <!-- <div id="human-exposure-legend" class="legend">
              <h4>HRS Score</h4>
              <div><span style="background-color: #707070"></span>Score not available</div>
              <div><span style="background-color: #ecda9a"></span>30.0-45.0</div>
              <div><span style="background-color: #f3ad6a"></span>45.1-60.0</div>
              <div><span style="background-color: #f97b57"></span>60.1-75.0</div>
              <div><span style="background-color: #ee4d5a"></span>75.1-84.91</div>
            </div> -->
        </figure>
  
        <!-- Prose for the project, additional info describing each scene. -->
        <article>
          <!-- Each div must have the class that you specify in the myScrollama.setup() -->

          <!-- Scene 1 -->
          <div class="step">
            <p>The Superfund program is responsible for the investigation and clean-up of contaminated sites left over from decades of unregulated industrial manufacturing and other activities. 
              The most highly contaminated sites which require longer-term remedial action take precedence and are placed on the National Priority List (NPL). 
              A site must receive a Hazard Ranking System (HRS) score of 28.5 to be placed on the NPL. 
            </p>
            <p>These sites displayed here are those currently on the NPL, proposed for the NPL, or that were once on the NPL but have been remedied enough to warrant deletion. 
              Also included are sites that qualify for the Superfund Alternative Approach (SAA). 
              The Superfund Alternative (SA) approach requires the same qualifying measures and standards as the NPL, but takes less time and resources to do so. 
            </p>
          </div>

          <!-- Scene 1a -->
          <div class="step">
            <p>Briefly discuss clean-up efforts--show sites that do not have human exposure under control yet, leading into next two case studies.</p>
          </div>

          <!-- Scene 2 -->
          <div class="step">
            <h3>GE-Pittsfield/Housatonic River Superfund Site</h3>
            <p>Between 1907 and 1987, the General Electric transformer plant on the banks of the Housatonic River in Pittsfield MA “was one of the crown jewels of GE’s electrical infrastructure, high voltage testing, and defense contracting businesses." 
              In the 1930’s, the plant began using PCB’s as a coolant to manufacture their transformers.
            </p>
            <p>PCBs do not break down in the environment and are now known to cause both cancer and serious non-cancer health effects, including neurological, immune, endocrine and reproductive issues in humans. 
              For decades until they were banned in 1979, PCBs leaked from piping throughout the GE plant into the ground, ultimately making their way into the Housatonic River. 
              PCBs were also dumped directly into the river or other areas around the campus. 
            </p>
            <p>Source: <a href='https://www.wbur.org/radioboston/2016/06/29/ge-and-pittsfield' target = '_blank'>GE Left Behind A Complex Legacy In Pittsfield</a></p>
            <img src='images/ge-warning-sign.png'>
            <p>Photo Credit: <a href='https://www.masslive.com/politics/2016/01/in_pittsfield_general_electric.html'>Don Treeger</a></p>
          </div>
  
          <!-- Scene 2a -->
          <div class="step">
            <p>The massive plant was integral to life in Pittsfield, employing nearly 13,000 people at its height in the 1940s and occupying over 300 acres. 
              The plant began to gradually dismantle in the late 1970’s, closed its transformer division in 1986, and finally shuttered for good in 2007. 
            </p>
            <p>The enormous footprint left behind by the plant’s closure is now part of the clean-up area designated by this Superfund site. 
              The cleanup areas include various complexes making up the GE campus, in addition to properties located in the Housatonic's floodplain, the Allendale School area, former oxbow areas resulting from rechannelization of the river in the 1940s, and a half-mile reach of contaminated riverbanks and sediments in the East Branch of the Housatonic River.
            </p>
            <p>Source: <a href='https://www.masslive.com/politics/2016/01/in_pittsfield_general_electric.html' target = '_blank'>In Pittsfield, General Electric plant closures leave bitter memories</a> and <a href='https://www.epa.gov/ge-housatonic' target = '_blank'>EPA</a></p>
            <img src='images/ge-aerial.jpg'>
            <p>Photo Credit: <a href='https://www.berkshireeagle.com/stories/new-life-for-old-buildings,536027'>Warren Fowler</a></p>


          </div>

          <!-- Scene 2b -->
          <div class="step">
            <p>Over time, storms and floods have disturbed PCB laden sediment from the river bottom and soil from contaminated river banks, redistributing it further down the river and into floodplains. 
              The “Rest of River” cleanup area included in this Superfund site covers nearly 125 miles from the confluence of the East and West Branches in Pittsfield to just before the Long Island Sound in Connecticut.
            </p>
            <p>PCBs are persistent in the environment, resistant to degradation, and accumulate quickly in the body but are very slow to leave. 
              Fish and wildlife throughout the Housatonic watershed have tested at very high concentrations of PCBs, and both Massachusetts and Connecticut have issued consumption advisories. 
              Humans are also at risk for exposure by direct contact with contaminated soil or sediment, or consumption of agricultural products produced in the floodplain. 
              PCBs could remain present in the Housatonic River ecosystem for hundreds of years without intervention.
            </p>
            <p>Source: <a href='https://www.epa.gov/ge-housatonic' target = '_blank'>EPA</a></p>
            <img src='images/housatonic-warning.jpg'>
            <p>Photo Credit: <a href='https://www.manchesterjournal.com/stories/think-decades-not-years-to-achieve-one-housatonic-river-health-marker,602748?'>Eagle File Photo</a></p>
          </div>

          <!-- Scene 3 -->
          <div class="step">
            <h3>The Old Lead Belt</h3>
            <p>Missouri is home to the largest lead concentrations in the world, which has been mined for over a century. 
              The seven Superfund sites seen here are defunct lead mines located in the Southeast Missouri Lead District. 
              Mining at these sites left behind hundreds of millions of tons of mining waste contaminated with lead, and other heavy metals and toxic chemicals. 
              Much of this waste is in the form of enormous chat piles that are susceptible to wind and water erosion. 
              By the time the EPA began remediating sites, covering these piles to prevent erosion, the damage was already done.
            </p>
            <p>Source: <a href='http://www.msnbc.com/msnbc/life-missouris-fading-old-lead-belt' target = '_blank'>Life in Missouri’s Fading Old Lead Belt</a></p>
            <img src='images/park-hills-chat-pile.jpg'>
            <p>Photo Credit: <a href='http://www.nbcnews.com/id/8132449/ns/us_news-environment/t/toxic-mound-beloved-ex-mining-town/#.XrttSmhKg2w'>James A. Finley / AP</a></p>
          </div>

          <!-- Scene 3a -->
          <div class="step">
            <p>Contaminants from the chat piles has been distributed throughout the area, now encompassing an area much larger than is first suggested by the location of each site. 
              The total area affected by these seven Superfund sites covers four entire counties in Missouri: Washington, Jefferson, St. Francois, and Madison.
            </p>
          </div>

          <!-- Scene 4 -->
          <div class="step">
            <p>Toxic Release Inventory--show clusters of sites</p>
          </div>

         <!-- Scene 4a -->
          <div class="step">
            <p>Discuss complexity of system, determining hazard depends on toxicity weights and fate of chemical in environment, among other things--show top sites by RSEI score.</p>
          </div>

          <!-- Scene 5 -->
          <div class="step">
            <p>For example, an investigation into RSEI scores by direct water release, the Upper Tennessee watershed stands out with the second highest score of 1,138,280.</p>
          </div>

          <!-- Scene 5a -->
          <div class="step">
            <p>Upon further investigation, the largest share of this score can be traced back to one facility, the Eastman Chemical Co Tennessee Operations on the South Fork Holston River with a total RSEI score of 802,241 by direct water release, primarily from arsenic and dioxane. But what about facilities who don't report their releases properly?</p>
          </div>

          <!-- Scene 6 -->
          <div class="step">
            <p>Chemical Valley in West Virginia has a long history of industrial pollution.</p>
            <img src='images/wv-monsanto.jpg'>
          </div>

          <!-- Scene 6a -->
          <div class="step">
            <p>2014 Elk River chemical spill. This site is not even on the TRI because it did not properly report or have permits to discharge into the river.</p>
            <img src='images/elk-river.jpg'>
          </div>

          <!-- Scene 6b -->
          <div class="step">
            <p>As a result, the water supply was poisoned for over 300,000 residents in nine counties.</p>
          </div>

          <!-- Scene 7 -->
          <div class="step">
            <p>Maybe show all facilities along waterways in the US here?</p>
          </div>

          <!-- Scene 8 -->
          <div class="step">
            <p>Look at CDC vulnerability index and find an area or two that would be most vulnerable in case of chemical spill?</p>
          </div>

          <!-- Scene 9 -->
          <div class="step">
            <p>Pollution on tribal lands--I found some discrepancies in reporting data and then the spatial analysis that I performed in QGIS that may be worth highlighting. First show all TRI facilities and Superfund sites that affect Native Americans according to the reported data.</p>
          </div>

          <!-- Scene 9a -->
          <div class="step">
            <p>Now show those sites plus the ones that actually fall on tribal lands in a QGIS count points in polygon analysis.</p>
          </div>

          <!-- Scene 10 -->
          <div class="step">
            <p>Looking at the maps in the previous two sections, maybe look at Oklahoma for a case study.</p>
          </div>

          <!-- Scene 11 -->
          <div class="step">
            <p>geocode option to find sites close to you?</p>
          </div>

        </article>
  
      </section>
  
      <!-- OPIONAL: Scrollytelling Outro --> 
      <section id="outro">
        <p style="text-align : center"><br><a href="#top">Jump to top of page</a><br></p>
      </section>
    
    </main>
  

    </section>
      
       

    <!-- Bootstrap core CSS -->
    <link href="vendor\bootstrap\css\bootstrap.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" /> -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href='css/style.css' rel='stylesheet' />
    <!-- <link rel="stylesheet" href="libs/Leaflet.markercluster/MarkerCluster.Default.css"> />
    <link rel="stylesheet" href="libs/Leaflet.markercluster/MarkerCluster.css"> /> -->
    <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Average&display=swap" rel="stylesheet">
<body>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.js"></script>
    <!-- <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script> -->
    <!-- <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/scrollama/2.2.1/scrollama.min.js"></script>
    <!-- <script src="libs/Leaflet.markercluster/leaflet.markercluster.js"></script> -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.5/chroma.min.js"></script>




    <!-- <script src='js/app.js'></script> -->

    <script>

      // force page to reload at top
      jQuery(document).ready(function(){
        jQuery(this).scrollTop(0);
      });

  // ---------Section 0: Make a scrollama--------------- 
  // Create a scrollama object.
  // ---------------------------------------------------
  var myScrollama = scrollama();

  // ---------Section 1: Set Heights---------------
  //#region
  // Set the size of the figure and the height of the steps
  // These are set to constants to improve performance on mobile devices, while keeping the code relatively simple.
  // ----------------------------------------------
  const figureHeight = window.innerHeight * 0.8
  const figureMarginTop = (window.innerHeight - figureHeight) / 2
  const stepH = Math.floor(window.innerHeight * 1.8);
  //#endregion

  // ---------Section 2: HTML -> D3--------------- 
  //#region
  // Save different parts of the page as D3.js objects. We'll use these later for easy restyling. D3.js is used for convenience.
  // ---------------------------------------------
  var figure = d3.select('figure');
  var article = d3.select('article');
  var steps = d3.selectAll('.step');
  //#endregion

  // ---------Section 3: handleResize()---------------
  //#region
  // Create a function which sets the styling of the various elements exactly as you want it to appear
  // This function could increase in complexity as you build responsive scrollytelling webpages. Here, this function
  // is relatively simple.
  // -------------------------------------------------
  function handleResize() {
    
    console.log("handling resize")

    // 1. update height of step elements
    steps.style('height', stepH + 'px');

    // 2. update height, margin, and layering of the figure
    figure
      .style('height', figureHeight + 'px')
      .style('top', figureMarginTop + 'px')
      .style("z-index", 1);

    // 3. force the article to appear on top of the figure
    article.style("z-index", 2);

    // 4. tell scrollama to update new element dimensions. Not always necessary, but included just to be safe.
    myScrollama.resize();

  }
  //#endregion

  // ---------Section 4: handleStepChange()---------------
  // Create a function to update the map in response to step-triggers.
  // setting map view, and removing and adding layers
  // this gets a little complicated/clunky and I'm not sure this is the best way to proceed
  // -----------------------------------------------------
  function handleStepChange(response) {
  
    console.log(response)

    // create array of layers to be turned off in each case before adding back relevant layers
    const allLayers = ['superfund-layer', 'tri-layer', 'ge-layer', 'housatonic-layer', 'lead-belt-area-layer', 'spill-layer']

    // create array of individual markers to be removed in each case before adding back relevant markers
    const allMarkers = [freedomMarker]

    // const humanExposureLegend = document.getElementById('human-exposure-legend');

    switch(response.index) {
      case 0:
        // Scene 1
        // Superfund sites
        map.flyTo({
          center: [-107.79, 35.08],
          zoom: 3.789,
          pitch: 0,
          bearing: 0
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('superfund-layer','visibility', 'visible');
        map.setFilter('superfund-layer', null);
        map.setPaintProperty('superfund-layer', 'circle-radius', 2.5)

        // humanExposureLegend.style.display = 'none';
        break;

      case 1:
        // Scene 1a
        // Human exposure sites
        map.flyTo({
          center: [-107.79, 35.08],
          zoom: 3.789,
          pitch: 0,
          bearing: 0
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('superfund-layer','visibility', 'visible');
        map.setFilter('superfund-layer', ['in', "HUMAN_EXPOSURE_UNDER_CONTROL", 'No', 'Insufficient Data']);
        map.setPaintProperty('superfund-layer', 'circle-radius', 2.5)

        // humanExposureLegend.style.display = 'block';
        break;
  
      case 2:
        // Scene 2
        // GE Pittsfield Site
        map.flyTo({
          center: [-73.2420, 42.4483],
          zoom: 14,
          pitch: 0,
          bearing: 0
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('superfund-layer','visibility', 'visible');
        map.setFilter('superfund-layer', ['==', 'SITE_NAME', 'GE PITTSFIELD HOUSATONIC RIVER SUPERFUND SITE']);
        map.setPaintProperty('superfund-layer', 'circle-radius', 6)
        break;
      
      case 3:
        // Scene 2a
        // Full GE site extent map
        map.flyTo({
          center: [-73.2342, 42.4537], 
          zoom: 13,
          pitch: 0,
          bearing: 0,
          speed: .25
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('superfund-layer','visibility', 'visible');
        map.setFilter('superfund-layer', ['==', 'SITE_NAME', 'GE PITTSFIELD HOUSATONIC RIVER SUPERFUND SITE']);
        map.setPaintProperty('superfund-layer', 'circle-radius', 6)
        map.setLayoutProperty('ge-layer','visibility', 'visible');
        break;

      case 4:
        // Scene 2b
        // Housatonic River extent
        map.flyTo({
          center: [-73.9481, 41.7777], 
          zoom: 7.25,
          pitch: 0,
          bearing: 0,
          speed: .5
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('housatonic-layer','visibility', 'visible');
        map.setLayoutProperty('superfund-layer','visibility', 'visible');
        map.setFilter('superfund-layer', ['==', 'SITE_NAME', 'GE PITTSFIELD HOUSATONIC RIVER SUPERFUND SITE']);
        map.setPaintProperty('superfund-layer', 'circle-radius', 6)
        break;

      case 5:
        // Scene 3
        // Missouri Old Lead Belt sites
        map.flyTo({
          center: [-90.8029, 37.852], 
          zoom: 9,
          pitch: 0,
          bearing: 0
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('superfund-layer','visibility', 'visible');
        map.setFilter('superfund-layer', ['in', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.', 'WASHINGTON COUNTY LEAD DISTRICT - FURNACE CREEK', 'WASHINGTON COUNTY LEAD DISTRICT - POTOSI', 'WASHINGTON COUNTY LEAD DISTRICT - OLD MINES', 'WASHINGTON COUNTY LEAD DISTRICT - RICHWOODS', 'SOUTHWEST JEFFERSON COUNTY MINING', 'ANSCHUTZ - MADISON MINE']);
        map.setPaintProperty('superfund-layer', 'circle-radius', 6)
        break;

      case 6:
        // Scene 3a
        // Missouri Old Lead Belt areas
        map.flyTo({
          center: [-90.97511, 37.98508], 
          zoom: 8,
          pitch: 0,
          bearing: 0,
          speed: .25
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('superfund-layer','visibility', 'visible');
        map.setFilter('superfund-layer', ['in', 'SITE_NAME', 'BIG RIVER MINE TAILINGS/ST. JOE MINERALS CORP.', 'WASHINGTON COUNTY LEAD DISTRICT - FURNACE CREEK', 'WASHINGTON COUNTY LEAD DISTRICT - POTOSI', 'WASHINGTON COUNTY LEAD DISTRICT - OLD MINES', 'WASHINGTON COUNTY LEAD DISTRICT - RICHWOODS', 'SOUTHWEST JEFFERSON COUNTY MINING', 'ANSCHUTZ - MADISON MINE']);
        map.setPaintProperty('superfund-layer', 'circle-radius', 6)
        map.setLayoutProperty('lead-belt-area-layer','visibility', 'visible');
        break;

      case 7:
        // Scene 4
        // TRI facility cluster
        map.flyTo({
          center: [-107.79, 35.08],
          zoom: 3.789,
          pitch: 0,
          bearing: 0
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('tri-layer','visibility', 'visible');
        break;

      case 8:
        // Scene 4a
        // TRI top facilities by RSEI score
  
        break;

      case 9:
        // Scene 5
        // Upper Tennessee Watershed
        // map.setView([36.686041276581925, -99.42626953125001], 5)
   
        break;

        case 10:
        // Scene 5a
        // South Fork-Holston Watershed and Eastman Chemical Co Tennessee Operations facility
        
        break;

        case 11:
        // Scene 6
        // Chemical Valley in West Virginia
        map.flyTo({
          center: [-81.8606, 38.4143],
          zoom: 10.78,
          pitch: 48.5,
          bearing: -7.2
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('tri-layer','visibility', 'visible');
        map.setPaintProperty('tri-layer', 'circle-radius', 6)
        break;
        
        case 12:
        // Scene 6a
        // Zoom to Freedom Industry facility that had chemical spill
        map.flyTo({
          center: [-81.6153, 38.3681],
          zoom: 14.78,
          pitch: 0,
          bearing: 0
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('wv-tri-layer','visibility', 'visible');
        map.once('moveend', function(e) {
          freedomMarker.addTo(map);
        });
        break;

        case 13:
        // Scene 6b
        // show counties affected by spill
        map.flyTo({
          center: [-81.6153, 38.3681],
          zoom: 8,
          pitch: 0,
          bearing: 0
        });
        allLayers.forEach(item => map.setLayoutProperty(item, 'visibility', 'none'));
        allMarkers.forEach(item => item.remove());
        map.setLayoutProperty('spill-layer','visibility', 'visible');
        freedomMarker.addTo(map);
        break;

        case 14:
        // Scene 7
        // all facilities along waterways in US?
      
        break;

        case 15:
        // Scene 8
        // CDC vulnerability index?
   
        break;

        case 16:
        // Scene 9
        // Pollution on tribal lands--first show everything reported by EPA
   
       
        break;

        case 17:
        // Scene 9a
        // then show all sites that actually fall on tribal lands
       
       
        break;

        case 18:
        // Scene 9b
        // a case study?
      
        break;

      default:
        // do nothing

    }

  }

  // ---------Section 5: init()--------------- 
  // Create a function that will run just once that first makes sure all the elements are sized like you want them,
  // and then sets up the scrollama. Finally, add an event listener to detect if the screen size has changed.
  // -----------------------------------------
  function init() {

    // 1. force a resize on load to ensure proper dimensions are sent to scrollama
    handleResize();

    // 2. Setup the scrollama
    myScrollama.setup({
      step: '.step',
      offset: Math.floor(window.innerHeight) * 0.95 + "px",
      // set to true to see debug horizontal line
      debug: true,
    }).onStepEnter(handleStepChange)
      
    // setup resize event
    window.addEventListener('resize', handleResize);
  }


  // ---------Section 6: Wrap Up--------------- 
  // This is where you'll want to include any other JavaScript that you've created for the webpage, and to run the init() function. 
  // ------------------------------------------
  // init();

  // DARK BASEMAP
  // add mapbox access token
  mapboxgl.accessToken = 'pk.eyJ1IjoiZWlsZWVuZ3JhZHkiLCJhIjoiY2pvNG00eXVjMDFlcjNxcW1yZ3I2OTJ2ZSJ9.l2EtBykdOJSCNiszd2NbaA';

  // initalize map
  var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/eileengrady/ck9vlhb4417hl1iqmcr1eoyr4', // stylesheet location
    center: [-107.79, 35.08], // starting position [lng, lat]
    zoom: 3.789, // starting zoom
    scrollZoom: false
  });

  // // LIGHT BASEMAP
  // mapboxgl.accessToken = 'pk.eyJ1IjoiZWlsZWVuZ3JhZHkiLCJhIjoiY2pvNG00eXVjMDFlcjNxcW1yZ3I2OTJ2ZSJ9.l2EtBykdOJSCNiszd2NbaA';

  // var map = new mapboxgl.Map({
  //   container: 'map', // container id
  //   style: 'mapbox://styles/eileengrady/cka2ktdcx0sic1irxtx3nqw9u', // stylesheet location
  //   center: [-107.79, 35.08], // starting position [lng, lat]
  //   zoom: 3.789, // starting zoom
  //   scrollZoom: false
  // });

  // create marker for GE Pittsfield site
  // var geMarker = new mapboxgl.Marker()
  //   .setLngLat([-73.232222, 42.450278])

  // create marker for Freedom Industries in WV
  var freedomMarker = new mapboxgl.Marker()
    .setLngLat([-81.606774, 38.368888])

  map.on('load', function() {

    var popup = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
    });

    // construct popup for Superfund sites
    map.on('mouseenter', 'superfund-layer', function(e) {
      // Change the cursor style as a UI indicator.
      map.getCanvas().style.cursor = 'pointer';

      var coordinates = e.features[0].geometry.coordinates.slice();

      // Ensure that if the map is zoomed out such that multiple
      // copies of the feature are visible, the popup appears
      // over the copy being pointed to.
      while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
      coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
      }

      // Populate the popup and set its coordinates
      // based on the feature found.
      popup
      .setLngLat(coordinates)
      .setHTML('<h3>' + e.features[0].properties.SITE_NAME + '<h/3>' +
        '<h4>Location: ' + e.features[0].properties.CITY + ' ' + e.features[0].properties.STATE + '<h/4>' +
        '<h4>Site Type: ' + e.features[0].properties.SITE_TYPE + '<h/4>' +
        '<h4>Status: ' + e.features[0].properties.NPL_STATUS_x + '<h/4>' +
        '<h4>HRS score: ' + e.features[0].properties.HRS_SCORE + '<h/4>')
      .addTo(map);
    });

    map.on('mouseleave', 'superfund-layer', function() {
      map.getCanvas().style.cursor = '';
      popup.remove();
    });

    // add source and layer for GE Pittsfield site map
    map.addSource('ge-source', {
      type: 'geojson',
      data: 'data/ge-site-area.geojson'
    });

    map.addLayer({
      'id': 'ge-layer',
      'type': 'line',
      'source': 'ge-source',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
        'line-color': '#F9C74F',
        // 'line-width': 1
      }
    });

    // construct popup for GE site map layer
    map.on('mouseenter', 'ge-layer', function(e) {
      // Change the cursor style as a UI indicator.
      map.getCanvas().style.cursor = 'pointer';

      // var coordinates = e.features[0].geometry.coordinates[0];
      var coordinates = e.lngLat;

      // Ensure that if the map is zoomed out such that multiple
      // copies of the feature are visible, the popup appears
      // over the copy being pointed to.
      while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
      coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
    }

    // Populate the popup and set its coordinates
    // based on the feature found.
    popup
      .setLngLat(coordinates)
      .setHTML('<h3>' + e.features[0].properties.name + '<h/3>')
      .addTo(map);
    });

    map.on('mouseleave', 'ge-layer', function() {
      map.getCanvas().style.cursor = '';
      popup.remove();
    });

    // add source and layer for Housatonic River
    map.addSource('housatonic-source', {
      type: 'geojson',
      data: 'data/housatonic-river.geojson'
    });

    map.addLayer({
      'id': 'housatonic-layer',
      'type': 'line',
      'source': 'housatonic-source',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
        'line-color': '#5FAECC',
        'line-width': 1.5
      }
    });

    // add source and layer for Lead Belt sites
    // map.addLayer({
    //   'id': 'lead-belt-sites-layer',
    //   'type': 'circle',
    //   'source': 'superfund-source',
    //   'layout': {
    //     'visibility': 'none'
    //   },
    //   'filter': ['==', 'MAP_CHAPTER', 'MO lead belt'],
    //   'paint': {
    //     'circle-radius': 5,
    //     'circle-color': '#AAF0D1'
    //   }
    // });

    // add source and layer for Lead Belt areas
    map.addSource('lead-belt-area-source', {
      type: 'geojson',
      data: 'data/missouri-lead-belt.geojson'
    });

    map.addLayer({
      'id': 'lead-belt-area-layer',
      'type': 'line',
      'source': 'lead-belt-area-source',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
        'line-color': '#43AA8B',
        'line-width': 2
      }
    });

    // add source and layer for counties affected by Freedom Industry spill
    map.addSource('spill-source', {
      type: 'geojson',
      data: 'data/elk-river-spill-counties.geojson'
    });

    map.addLayer({
      'id': 'spill-layer',
      'type': 'line',
      'source': 'spill-source',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
        'line-color': '#FF9933',
        'line-width': 2
      }
    });


    init();
  })



    
    </script>

    
  </body>

  
</html>
